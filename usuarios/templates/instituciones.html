{% extends 'base.html' %}
{% load static %}
{% load icons %}

{% block content %}
<main class="container py-5">
    <section class="card card-body shadow-sm p-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center pb-4">
                <h1 class="display-5">Gestión de instituciones</h1>
                <div>
                    <a class="btn btn-primary me-2" data-toggle="tooltip" data-placement="top" title="Crear institucion" data-bs-toggle="modal" data-bs-target="#crearInstitucionModal">
                        {% icon 'plus' %}
                    </a>
                </div>
            </div>
            <div class="table-responsive">
                <table id="instituciones" class="table table-hover table-bordered align-middle">
                    <thead class="table-secondary text-center">
                        <tr>
                        <th>Acciones</th>
                        <th>Nombre</th>
                        <th>Direccion</th>
                        <th>Municipio</th>
                        <th>Departamento</th>
                        <th>Sector</th>
                        <th>Esta</th>
                        <th>Dane</th>
                        <th>Genero</th>
                        <th>Zona</th>
                    </tr>
                </thead>
            </table>
        </div>
        </div>
    </div>
    </section>
</main>
<!-- Modal para crear institucion!!!!!!!!!!!!!!!!!!! -->
<div class="modal fade" id="crearInstitucionModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalLabel">Crear Institución</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <form id="formCrearInstitucion" action="/instituciones/crear/" method="POST">
                    {{error}}
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.nom.id_for_label }}" class="form-label"">
                                    {{ institucionForm.nom.label }}
                                </label>
                                {{ institucionForm.nom }}
                                {% if institucionForm.nom.errors %}
                                    <div class="text-danger">{{ institucionForm.nom.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.esta.id_for_label }}" class="form-label"">
                                    {{ institucionForm.esta.label }}
                                </label>
                                {{ institucionForm.esta }}
                                {% if institucionForm.esta.errors %}
                                    <div class="text-danger">{{ institucionForm.esta.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.depa.id_for_label }}" class="form-label"">
                                    {{ institucionForm.depa.label }}
                                </label>
                                {{ institucionForm.depa }}
                                {% if institucionForm.depa.errors %}
                                    <div class="text-danger">{{ institucionForm.depa.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.muni.id_for_label }}" class="form-label"">
                                    {{ institucionForm.muni.label }}
                                </label>
                                {{ institucionForm.muni }}
                                {% if institucionForm.muni.errors %}
                                    <div class="text-danger">{{ institucionForm.muni.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.secto.id_for_label }}" class="form-label"">
                                    {{ institucionForm.secto.label }}
                                </label>
                                {{ institucionForm.secto }}
                                {% if institucionForm.secto.errors %}
                                    <div class="text-danger">{{ institucionForm.secto.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.vigen.id_for_label }}" class="form-label"">
                                    {{ institucionForm.vigen.label }}
                                </label>
                                {{ institucionForm.vigen }}
                                {% if institucionForm.vigen.errors %}
                                    <div class="text-danger">{{ institucionForm.vigen.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Tooltip on top">
                                <label for="{{ institucionForm.coordi.id_for_label }}" class="form-label" >
                                    {{ institucionForm.coordi.label }}
                                </label>
                                {{ institucionForm.coordi }}
                                {% if institucionForm.coordi.errors %}
                                    <div class="text-danger">{{ institucionForm.coordi.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.coordi_mail.id_for_label }}" class="form-label"">
                                    {{ institucionForm.coordi_mail.label }}
                                </label>
                                {{ institucionForm.coordi_mail }}
                                {% if institucionForm.coordi_mail.errors %}
                                    <div class="text-danger">{{ institucionForm.coordi_mail.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.coordi_tele.id_for_label }}" class="form-label"">
                                    {{ institucionForm.coordi_tele.label }}
                                </label>
                                {{ institucionForm.coordi_tele }}
                                {% if institucionForm.coordi_tele.errors %}
                                    <div class="text-danger">{{ institucionForm.coordi_tele.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.dire.id_for_label }}" class="form-label"">
                                    {{ institucionForm.dire.label }}
                                </label>
                                {{ institucionForm.dire }}
                                {% if institucionForm.dire.errors %}
                                    <div class="text-danger">{{ institucionForm.dire.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.insti_mail.id_for_label }}" class="form-label"">
                                    {{ institucionForm.insti_mail.label }}
                                </label>
                                {{ institucionForm.insti_mail }}
                                {% if institucionForm.insti_mail.errors %}
                                    <div class="text-danger">{{ institucionForm.insti_mail.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.recto.id_for_label }}" class="form-label"">
                                    {{ institucionForm.recto.label }}
                                </label>
                                {{ institucionForm.recto }}
                                {% if institucionForm.recto.errors %}
                                    <div class="text-danger">{{ institucionForm.recto.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.recto_tel.id_for_label }}" class="form-label"">
                                    {{ institucionForm.recto_tel.label }}
                                </label>
                                {{ institucionForm.recto_tel }}
                                {% if institucionForm.recto_tel.errors %}
                                    <div class="text-danger">{{ institucionForm.recto_tel.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.gene.id_for_label }}" class="form-label"">
                                    {{ institucionForm.gene.label }}
                                </label>
                                {{ institucionForm.gene }}
                                {% if institucionForm.gene.errors %}
                                    <div class="text-danger">{{ institucionForm.gene.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.grados.id_for_label }}" class="form-label"">
                                    {{ institucionForm.grados.label }}
                                </label>
                                {{ institucionForm.grados }}
                                {% if institucionForm.grados.errors %}
                                    <div class="text-danger">{{ institucionForm.grados.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.jorna.id_for_label }}" class="form-label"">
                                    {{ institucionForm.jorna.label }}
                                </label>
                                {{ institucionForm.jorna }}
                                {% if institucionForm.jorna.errors %}
                                    <div class="text-danger">{{ institucionForm.jorna.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.num_sedes.id_for_label }}" class="form-label"">
                                    {{ institucionForm.num_sedes.label }}
                                </label>
                                {{ institucionForm.num_sedes }}
                                {% if institucionForm.num_sedes.errors %}
                                    <div class="text-danger">{{ institucionForm.num_sedes.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.zona.id_for_label }}" class="form-label"">
                                    {{ institucionForm.zona.label }}
                                </label>
                                {{ institucionForm.zona }}
                                {% if institucionForm.zona.errors %}
                                    <div class="text-danger">{{ institucionForm.zona.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.cale.id_for_label }}" class="form-label"">
                                    {{ institucionForm.cale.label }}
                                </label>
                                {{ institucionForm.cale }}
                                {% if institucionForm.cale.errors %}
                                    <div class="text-danger">{{ institucionForm.cale.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.dane.id_for_label }}" class="form-label"">
                                    {{ institucionForm.dane.label }}
                                </label>
                                {{ institucionForm.dane }}
                                {% if institucionForm.dane.errors %}
                                    <div class="text-danger">{{ institucionForm.dane.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Modal para editar institucion!!!!!!!!!!!!!!!!!!!!!!! -->
<div class="modal fade" id="editarInstitucionModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalLabel">Editar Institución</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <form id="formEditarInstitucion" method="POST">
                    {{error}}
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.nom.id_for_label }}" class="form-label"">
                                    {{ institucionForm.nom.label }}
                                </label>
                                {{ institucionForm.nom }}
                                {% if institucionForm.nom.errors %}
                                    <div class="text-danger">{{ institucionForm.nom.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.esta.id_for_label }}" class="form-label"">
                                    {{ institucionForm.esta.label }}
                                </label>
                                {{ institucionForm.esta }}
                                {% if institucionForm.esta.errors %}
                                    <div class="text-danger">{{ institucionForm.esta.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <!-- <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.depa.id_for_label }}" class="form-label"">
                                    {{ institucionForm.depa.label }}
                                </label>
                                {{ institucionForm.depa }}
                                {% if institucionForm.depa.errors %}
                                    <div class="text-danger">{{ institucionForm.depa.errors }}</div>
                                {% endif %}
                            </div>
                        </div> -->
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="{{ institucionForm.muni.id_for_label }}" class="form-label"">
                                    {{ institucionForm.muni.label }}
                                </label>
                                {{ institucionForm.muni }}
                                {% if institucionForm.muni.errors %}
                                    <div class="text-danger">{{ institucionForm.muni.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.secto.id_for_label }}" class="form-label"">
                                    {{ institucionForm.secto.label }}
                                </label>
                                {{ institucionForm.secto }}
                                {% if institucionForm.secto.errors %}
                                    <div class="text-danger">{{ institucionForm.secto.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.vigen.id_for_label }}" class="form-label"">
                                    {{ institucionForm.vigen.label }}
                                </label>
                                {{ institucionForm.vigen }}
                                {% if institucionForm.vigen.errors %}
                                    <div class="text-danger">{{ institucionForm.vigen.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Tooltip on top">
                                <label for="{{ institucionForm.coordi.id_for_label }}" class="form-label" >
                                    {{ institucionForm.coordi.label }}
                                </label>
                                {{ institucionForm.coordi }}
                                {% if institucionForm.coordi.errors %}
                                    <div class="text-danger">{{ institucionForm.coordi.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.coordi_mail.id_for_label }}" class="form-label"">
                                    {{ institucionForm.coordi_mail.label }}
                                </label>
                                {{ institucionForm.coordi_mail }}
                                {% if institucionForm.coordi_mail.errors %}
                                    <div class="text-danger">{{ institucionForm.coordi_mail.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.coordi_tele.id_for_label }}" class="form-label"">
                                    {{ institucionForm.coordi_tele.label }}
                                </label>
                                {{ institucionForm.coordi_tele }}
                                {% if institucionForm.coordi_tele.errors %}
                                    <div class="text-danger">{{ institucionForm.coordi_tele.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.dire.id_for_label }}" class="form-label"">
                                    {{ institucionForm.dire.label }}
                                </label>
                                {{ institucionForm.dire }}
                                {% if institucionForm.dire.errors %}
                                    <div class="text-danger">{{ institucionForm.dire.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.insti_mail.id_for_label }}" class="form-label"">
                                    {{ institucionForm.insti_mail.label }}
                                </label>
                                {{ institucionForm.insti_mail }}
                                {% if institucionForm.insti_mail.errors %}
                                    <div class="text-danger">{{ institucionForm.insti_mail.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.recto.id_for_label }}" class="form-label"">
                                    {{ institucionForm.recto.label }}
                                </label>
                                {{ institucionForm.recto }}
                                {% if institucionForm.recto.errors %}
                                    <div class="text-danger">{{ institucionForm.recto.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.recto_tel.id_for_label }}" class="form-label"">
                                    {{ institucionForm.recto_tel.label }}
                                </label>
                                {{ institucionForm.recto_tel }}
                                {% if institucionForm.recto_tel.errors %}
                                    <div class="text-danger">{{ institucionForm.recto_tel.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.gene.id_for_label }}" class="form-label"">
                                    {{ institucionForm.gene.label }}
                                </label>
                                {{ institucionForm.gene }}
                                {% if institucionForm.gene.errors %}
                                    <div class="text-danger">{{ institucionForm.gene.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.grados.id_for_label }}" class="form-label"">
                                    {{ institucionForm.grados.label }}
                                </label>
                                {{ institucionForm.grados }}
                                {% if institucionForm.grados.errors %}
                                    <div class="text-danger">{{ institucionForm.grados.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.jorna.id_for_label }}" class="form-label"">
                                    {{ institucionForm.jorna.label }}
                                </label>
                                {{ institucionForm.jorna }}
                                {% if institucionForm.jorna.errors %}
                                    <div class="text-danger">{{ institucionForm.jorna.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.num_sedes.id_for_label }}" class="form-label"">
                                    {{ institucionForm.num_sedes.label }}
                                </label>
                                {{ institucionForm.num_sedes }}
                                {% if institucionForm.num_sedes.errors %}
                                    <div class="text-danger">{{ institucionForm.num_sedes.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.zona.id_for_label }}" class="form-label"">
                                    {{ institucionForm.zona.label }}
                                </label>
                                {{ institucionForm.zona }}
                                {% if institucionForm.zona.errors %}
                                    <div class="text-danger">{{ institucionForm.zona.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.cale.id_for_label }}" class="form-label"">
                                    {{ institucionForm.cale.label }}
                                </label>
                                {{ institucionForm.cale }}
                                {% if institucionForm.cale.errors %}
                                    <div class="text-danger">{{ institucionForm.cale.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ institucionForm.dane.id_for_label }}" class="form-label"">
                                    {{ institucionForm.dane.label }}
                                </label>
                                {{ institucionForm.dane }}
                                {% if institucionForm.dane.errors %}
                                    <div class="text-danger">{{ institucionForm.dane.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
$(document).ready(function () {
    $('#instituciones').DataTable({
        processing: true,
        serverSide: true,
        ajax: {
            url: 'http://127.0.0.1:8000/api/data/',
            type: 'GET',
        },
        columns: [
            { data: 'nom', orderable: true, title: 'Nombre' },
            { data: 'dire', orderable: true, title: 'Dirección' },
            { data: 'municipio_nombre', orderable: true, title: 'Municipio' },
            { data: 'departamento_nombre', orderable: true, title: 'Departamento' },
            { data: 'secto', orderable: true, title: 'Sector' },
            { data: 'esta', orderable: true, title: 'Esta' },
            { data: 'dane', orderable: true, title: 'DANE' },
            { 
                data: 'gene', 
                orderable: true, 
                title: 'Género',
                render: function(data, type, row){
                    if (data == 'mi'){
                        return 'Mixto';
                    }else if (data == 'ma'){
                        return 'Masculino';
                    }else if (data == 'fe'){
                        return 'Femenino';
                    }else {
                        return 'Desconocido'
                    }
                }
            },
            {
                data: 'zona',
                orderable: true,
                title: 'Zona',
                render: function(data, type, row) {
                    if (data === 'r') {
                        return 'Rural';
                    } else if (data === 'u') {
                        return 'Urbana';
                    } else {
                        return 'Desconocido';
                    }
                }
            },
            {
                data: 'id',
                orderable: false,
                title: 'Acciones',
                render: function(data, type, row) {
                    return `
                        <button class="btn btn-sm btn-warning editar-institucion" data-id="${data}" data-bs-toggle="modal" data-bs-target="#editarInstitucionModal" data-toggle="tooltip" data-placement="top" title="Editar">
                            {% icon 'edit' %}
                        </button>
                    `;
                }
            }
        ],
        language: {
            url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json',
        },
    });
});

$(document).ready(function() {

        var $muni = $('#muni');
        $muni.empty(); // 🔹 Vacía los municipios al cargar la página
        $muni.append('<option value="">Seleccione un municipio</option>');
        $muni.prop('disabled', true); // 🔹 Deshabilita el campo de municipios inicialmente

        $('#id_depa').change(function() {
            var departamentoId = $(this).val();
            $muni.prop('disabled', true);
            $.ajax({
                url: "{% url 'api_municipios_form_insti' %}",
                data: {'departamento_id': departamentoId},
                dataType: 'json',
                success: function(data) {
                    var $muni = $('#muni');
                    $muni.empty();
                    $muni.append('<option value="">Seleccione un municipio</option>');

                    if (data.length === 0) {
                    } else {
                        $.each(data, function(index, item) {
                            $muni.append('<option value="' + item.id + '">' + item.nom_munici + '</option>');
                        });
                    }
                    $muni.prop('disabled', false);
                },
                error: function(xhr, status, error) {
                    console.log("Error en la solicitud AJAX:");
                    console.log("Estado:", status);
                    console.log("Error:", error);
                    console.log("Respuesta completa:", xhr.responseText);
                }
            });
        });
    });


    $(document).ready(function() {
    $("#formCrearInstitucion").submit(function(event) {
        event.preventDefault(); // Evita que la página se recargue

            var formData = $(this).serialize(); // Serializa los datos del formulario

            console.log("Datos del formulario serializados:", formData); // Depuración: muestra los datos del formulario

            $.ajax({
                type: "POST",
                url: $(this).attr("action"),
                data: formData,
                success: function(response) {
                    console.log("Respuesta del servidor:", response); // Depuración: muestra la respuesta del servidor
                    alert("Institución creada correctamente.");
                    $("#crearInstitucionModal").modal("hide");
                    location.reload(); // Recarga la página para actualizar la tabla
                },
                error: function(xhr, status, error) {
                    console.error("Error en la solicitud AJAX:"); // Depuración: muestra el error en la consola
                    console.error("Estado:", status);
                    console.error("Error:", error);
                    console.error("Respuesta del servidor:", xhr.responseText); // Depuración: muestra la respuesta completa del servidor

                    alert("Hubo un error al crear la institución. Revisa la consola para más detalles.");
                }
            });
        });
    });

    // Evento para capturar clic en botón de edición
$(document).on('click', '.editar-institucion', function() {
    var institucionId = $(this).data('id'); // Obtener el ID de la institución
    var url = `/api/institucion/${institucionId}/`; // URL de la API para obtener los datos
    var $form = $('#formEditarInstitucion'); 

    // Deshabilitar todos los inputs y selects mientras se cargan los datos
    $form.find('input, select, button').prop('disabled', true);

    $.ajax({
        url: url,
        type: 'GET',
        success: function(data) {
            // Llenar los campos del formulario con los datos obtenidos
            $form.find('input[name="nom"]').val(data.nom);
            $form.find('input[name="dire"]').val(data.dire);
            $form.find('select[name="muni"]').val(data.municipio);
            $form.find('select[name="secto"]').val(data.secto);
            $form.find('input[name="coordi"]').val(data.coordi);
            $form.find('input[name="coordi_mail"]').val(data.coordi_mail);
            $form.find('input[name="coordi_tele"]').val(data.coordi_tele);
            $form.find('select[name="esta"]').val(data.esta);
            $form.find('input[name="insti_mail"]').val(data.insti_mail);
            $form.find('input[name="recto"]').val(data.recto);
            $form.find('input[name="recto_tel"]').val(data.recto_tel);
            $form.find('input[name="vigen"]').val(data.vigen);
            $form.find('select[name="cale"]').val(data.cale);
            $form.find('input[name="dane"]').val(data.dane);
            $form.find('select[name="gene"]').val(data.gene);
            $form.find('input[name="grados"]').val(data.grados);
            $form.find('input[name="jorna"]').val(data.jorna);
            $form.find('input[name="num_sedes"]').val(data.num_sedes);
            $form.find('select[name="zona"]').val(data.zona);

            // Habilitar los campos después de cargar los datos
            $form.find('input, select, button').prop('disabled', false);

            // Agregar el ID al formulario para enviarlo en el POST
            $form.attr('action', `/institucion/editar/${institucionId}/`);
        },
        error: function(xhr, status, error) {
            console.error("Error al obtener los datos:", error);
            // En caso de error, habilitar los campos para permitir otra acción
            $form.find('input, select, button').prop('disabled', false);
        }
    });
});


    </script>
{% endblock %}